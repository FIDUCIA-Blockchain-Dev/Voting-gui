{"ast":null,"code":"/*\r\nThis file is part of web3.js.\r\n\r\nweb3.js is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU Lesser General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nweb3.js is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\nGNU Lesser General Public License for more details.\r\n\r\nYou should have received a copy of the GNU Lesser General Public License\r\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\r\n*/\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n// eslint-disable-next-line max-classes-per-file\nimport { DEFAULT_RETURN_FORMAT } from 'web3-types';\nimport { jsonRpc } from 'web3-utils';\nimport { SubscriptionError } from 'web3-errors';\n// eslint-disable-next-line import/no-cycle\nimport { Web3SubscriptionManager } from './web3_subscription_manager.js';\nimport { Web3EventEmitter } from './web3_event_emitter.js';\nexport class Web3Subscription extends Web3EventEmitter {\n  constructor(args, options) {\n    var _a;\n    super();\n    this.args = args;\n    const {\n      requestManager\n    } = options;\n    const {\n      subscriptionManager\n    } = options;\n    if (requestManager && subscriptionManager) {\n      throw new SubscriptionError('Only requestManager or subscriptionManager should be provided at Subscription constructor');\n    }\n    if (!requestManager && !subscriptionManager) {\n      throw new SubscriptionError('Either requestManager or subscriptionManager should be provided at Subscription constructor');\n    }\n    if (requestManager) {\n      // eslint-disable-next-line deprecation/deprecation\n      this._subscriptionManager = new Web3SubscriptionManager(requestManager, {}, true);\n    } else {\n      this._subscriptionManager = subscriptionManager;\n    }\n    this._returnFormat = (_a = options === null || options === void 0 ? void 0 : options.returnFormat) !== null && _a !== void 0 ? _a : DEFAULT_RETURN_FORMAT;\n  }\n  get id() {\n    return this._id;\n  }\n  get lastBlock() {\n    return this._lastBlock;\n  }\n  subscribe() {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._subscriptionManager.addSubscription(this);\n    });\n  }\n  processSubscriptionData(data) {\n    var _a, _b;\n    if (data === null || data === void 0 ? void 0 : data.data) {\n      // for EIP-1193 provider\n      this._processSubscriptionResult((_b = (_a = data === null || data === void 0 ? void 0 : data.data) === null || _a === void 0 ? void 0 : _a.result) !== null && _b !== void 0 ? _b : data === null || data === void 0 ? void 0 : data.data);\n    } else if (data && jsonRpc.isResponseWithNotification(data)) {\n      this._processSubscriptionResult(data === null || data === void 0 ? void 0 : data.params.result);\n    }\n  }\n  sendSubscriptionRequest() {\n    return __awaiter(this, void 0, void 0, function* () {\n      this._id = yield this._subscriptionManager.requestManager.send({\n        method: 'eth_subscribe',\n        params: this._buildSubscriptionParams()\n      });\n      return this._id;\n    });\n  }\n  get returnFormat() {\n    return this._returnFormat;\n  }\n  resubscribe() {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield this.unsubscribe();\n      yield this.subscribe();\n    });\n  }\n  unsubscribe() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.id) {\n        return;\n      }\n      yield this._subscriptionManager.removeSubscription(this);\n    });\n  }\n  sendUnsubscribeRequest() {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield this._subscriptionManager.requestManager.send({\n        method: 'eth_unsubscribe',\n        params: [this.id]\n      });\n      this._id = undefined;\n    });\n  }\n  // eslint-disable-next-line class-methods-use-this, @typescript-eslint/no-unused-vars\n  _processSubscriptionResult(_data) {\n    // Do nothing - This should be overridden in subclass.\n  }\n  // eslint-disable-next-line class-methods-use-this, @typescript-eslint/no-unused-vars\n  _processSubscriptionError(_err) {\n    // Do nothing - This should be overridden in subclass.\n  }\n  // eslint-disable-next-line class-methods-use-this\n  _buildSubscriptionParams() {\n    // This should be overridden in the subclass\n    throw new Error('Implement in the child class');\n  }\n}","map":{"version":3,"names":["DEFAULT_RETURN_FORMAT","jsonRpc","SubscriptionError","Web3SubscriptionManager","Web3EventEmitter","Web3Subscription","constructor","args","options","requestManager","subscriptionManager","_subscriptionManager","_returnFormat","_a","returnFormat","id","_id","lastBlock","_lastBlock","subscribe","addSubscription","processSubscriptionData","data","_processSubscriptionResult","_b","result","isResponseWithNotification","params","sendSubscriptionRequest","send","method","_buildSubscriptionParams","resubscribe","unsubscribe","removeSubscription","sendUnsubscribeRequest","undefined","_data","_processSubscriptionError","_err","Error"],"sources":["C:\\Users\\lakka\\OneDrive - Manipal Academy of Higher Education\\FIDUCIA\\voting-gui\\fiducia\\node_modules\\web3-core\\src\\web3_subscriptions.ts"],"sourcesContent":["ï»¿/*\r\nThis file is part of web3.js.\r\n\r\nweb3.js is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU Lesser General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nweb3.js is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\nGNU Lesser General Public License for more details.\r\n\r\nYou should have received a copy of the GNU Lesser General Public License\r\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\n// eslint-disable-next-line max-classes-per-file\r\nimport {\r\n\tBlockOutput,\r\n\tDEFAULT_RETURN_FORMAT,\r\n\tDataFormat,\r\n\tEthExecutionAPI,\r\n\tJsonRpcSubscriptionResult,\r\n\tJsonRpcSubscriptionResultOld,\r\n\tJsonRpcNotification,\r\n\tLog,\r\n\tHexString,\r\n\tWeb3APIParams,\r\n\tWeb3APISpec,\r\n} from 'web3-types';\r\nimport { jsonRpc } from 'web3-utils';\r\nimport { SubscriptionError } from 'web3-errors';\r\n\r\n// eslint-disable-next-line import/no-cycle\r\nimport { Web3SubscriptionManager } from './web3_subscription_manager.js';\r\nimport { Web3EventEmitter, Web3EventMap } from './web3_event_emitter.js';\r\nimport { Web3RequestManager } from './web3_request_manager.js';\r\n\r\nexport abstract class Web3Subscription<\r\n\tEventMap extends Web3EventMap,\r\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\tArgsType = any,\r\n\tAPI extends Web3APISpec = EthExecutionAPI,\r\n> extends Web3EventEmitter<EventMap> {\r\n\tprivate readonly _subscriptionManager: Web3SubscriptionManager<API>;\r\n\tprivate readonly _lastBlock?: BlockOutput;\r\n\tprivate readonly _returnFormat: DataFormat;\r\n\tprotected _id?: HexString;\r\n\r\n\tpublic constructor(\r\n\t\targs: ArgsType,\r\n\t\toptions: { subscriptionManager: Web3SubscriptionManager; returnFormat?: DataFormat },\r\n\t);\r\n\t/**\r\n\t * @deprecated This constructor overloading should not be used\r\n\t */\r\n\tpublic constructor(\r\n\t\targs: ArgsType,\r\n\t\toptions: { requestManager: Web3RequestManager<API>; returnFormat?: DataFormat },\r\n\t);\r\n\tpublic constructor(\r\n\t\tpublic readonly args: ArgsType,\r\n\t\toptions: (\r\n\t\t\t| { subscriptionManager: Web3SubscriptionManager }\r\n\t\t\t| { requestManager: Web3RequestManager<API> }\r\n\t\t) & {\r\n\t\t\treturnFormat?: DataFormat;\r\n\t\t},\r\n\t) {\r\n\t\tsuper();\r\n\t\tconst { requestManager } = options as { requestManager: Web3RequestManager<API> };\r\n\t\tconst { subscriptionManager } = options as { subscriptionManager: Web3SubscriptionManager };\r\n\t\tif (requestManager && subscriptionManager) {\r\n\t\t\tthrow new SubscriptionError(\r\n\t\t\t\t'Only requestManager or subscriptionManager should be provided at Subscription constructor',\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (!requestManager && !subscriptionManager) {\r\n\t\t\tthrow new SubscriptionError(\r\n\t\t\t\t'Either requestManager or subscriptionManager should be provided at Subscription constructor',\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (requestManager) {\r\n\t\t\t// eslint-disable-next-line deprecation/deprecation\r\n\t\t\tthis._subscriptionManager = new Web3SubscriptionManager(requestManager, {}, true);\r\n\t\t} else {\r\n\t\t\tthis._subscriptionManager = subscriptionManager;\r\n\t\t}\r\n\r\n\t\tthis._returnFormat = options?.returnFormat ?? (DEFAULT_RETURN_FORMAT as DataFormat);\r\n\t}\r\n\r\n\tpublic get id() {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tpublic get lastBlock() {\r\n\t\treturn this._lastBlock;\r\n\t}\r\n\r\n\tpublic async subscribe(): Promise<string> {\r\n\t\treturn this._subscriptionManager.addSubscription(this);\r\n\t}\r\n\r\n\tpublic processSubscriptionData(\r\n\t\tdata:\r\n\t\t\t| JsonRpcSubscriptionResult\r\n\t\t\t| JsonRpcSubscriptionResultOld<Log>\r\n\t\t\t| JsonRpcNotification<Log>,\r\n\t) {\r\n\t\tif (data?.data) {\r\n\t\t\t// for EIP-1193 provider\r\n\t\t\tthis._processSubscriptionResult(data?.data?.result ?? data?.data);\r\n\t\t} else if (\r\n\t\t\tdata &&\r\n\t\t\tjsonRpc.isResponseWithNotification(\r\n\t\t\t\tdata as unknown as JsonRpcSubscriptionResult | JsonRpcNotification<Log>,\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\tthis._processSubscriptionResult(data?.params.result);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async sendSubscriptionRequest(): Promise<string> {\r\n\t\tthis._id = await this._subscriptionManager.requestManager.send({\r\n\t\t\tmethod: 'eth_subscribe',\r\n\t\t\tparams: this._buildSubscriptionParams(),\r\n\t\t});\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tprotected get returnFormat() {\r\n\t\treturn this._returnFormat;\r\n\t}\r\n\tpublic async resubscribe() {\r\n\t\tawait this.unsubscribe();\r\n\t\tawait this.subscribe();\r\n\t}\r\n\r\n\tpublic async unsubscribe() {\r\n\t\tif (!this.id) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tawait this._subscriptionManager.removeSubscription(this);\r\n\t}\r\n\r\n\tpublic async sendUnsubscribeRequest() {\r\n\t\tawait this._subscriptionManager.requestManager.send({\r\n\t\t\tmethod: 'eth_unsubscribe',\r\n\t\t\tparams: [this.id] as Web3APIParams<API, 'eth_unsubscribe'>,\r\n\t\t});\r\n\t\tthis._id = undefined;\r\n\t}\r\n\r\n\t// eslint-disable-next-line class-methods-use-this, @typescript-eslint/no-unused-vars\r\n\tprotected _processSubscriptionResult(_data: unknown) {\r\n\t\t// Do nothing - This should be overridden in subclass.\r\n\t}\r\n\r\n\t// eslint-disable-next-line class-methods-use-this, @typescript-eslint/no-unused-vars\r\n\tprotected _processSubscriptionError(_err: Error) {\r\n\t\t// Do nothing - This should be overridden in subclass.\r\n\t}\r\n\r\n\t// eslint-disable-next-line class-methods-use-this\r\n\tprotected _buildSubscriptionParams(): Web3APIParams<API, 'eth_subscribe'> {\r\n\t\t// This should be overridden in the subclass\r\n\t\tthrow new Error('Implement in the child class');\r\n\t}\r\n}\r\n\r\nexport type Web3SubscriptionConstructor<\r\n\tAPI extends Web3APISpec,\r\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\tSubscriptionType extends Web3Subscription<any, any, API> = Web3Subscription<any, any, API>,\r\n> =\r\n\t| (new (\r\n\t\t\t// We accept any type of arguments here and don't deal with this type internally\r\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\t\t\targs: any,\r\n\t\t\toptions:\r\n\t\t\t\t| { subscriptionManager: Web3SubscriptionManager<API>; returnFormat?: DataFormat }\r\n\t\t\t\t| { requestManager: Web3RequestManager<API>; returnFormat?: DataFormat },\r\n\t  ) => SubscriptionType)\r\n\t| (new (\r\n\t\t\targs: any,\r\n\t\t\toptions: {\r\n\t\t\t\tsubscriptionManager: Web3SubscriptionManager<API>;\r\n\t\t\t\treturnFormat?: DataFormat;\r\n\t\t\t},\r\n\t  ) => SubscriptionType)\r\n\t| (new (\r\n\t\t\targs: any,\r\n\t\t\toptions: { requestManager: Web3RequestManager<API>; returnFormat?: DataFormat },\r\n\t  ) => SubscriptionType);\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}