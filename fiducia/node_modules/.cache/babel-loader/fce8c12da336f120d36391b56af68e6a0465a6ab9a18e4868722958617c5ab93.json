{"ast":null,"code":"/*\r\nThis file is part of web3.js.\r\n\r\nweb3.js is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU Lesser General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nweb3.js is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\nGNU Lesser General Public License for more details.\r\n\r\nYou should have received a copy of the GNU Lesser General Public License\r\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\r\n*/\nimport { bytesToHex } from 'web3-utils';\nimport { MAX_INTEGER, MAX_UINT64, SECP256K1_ORDER_DIV_2, secp256k1 } from './constants.js';\nimport { Chain, Common, Hardfork, toUint8Array, uint8ArrayToBigInt, unpadUint8Array } from '../common/index.js';\nimport { Capability } from './types.js';\nimport { Address } from './address.js';\nimport { checkMaxInitCodeSize } from './utils.js';\n/**\r\n * This base class will likely be subject to further\r\n * refactoring along the introduction of additional tx types\r\n * on the Ethereum network.\r\n *\r\n * It is therefore not recommended to use directly.\r\n */\nexport class BaseTransaction {\n  constructor(txData, opts) {\n    var _a, _b;\n    this.cache = {\n      hash: undefined,\n      dataFee: undefined\n    };\n    /**\r\n     * List of tx type defining EIPs,\r\n     * e.g. 1559 (fee market) and 2930 (access lists)\r\n     * for FeeMarketEIP1559Transaction objects\r\n     */\n    this.activeCapabilities = [];\n    /**\r\n     * The default chain the tx falls back to if no Common\r\n     * is provided and if the chain can't be derived from\r\n     * a passed in chainId (only EIP-2718 typed txs) or\r\n     * EIP-155 signature (legacy txs).\r\n     *\r\n     * @hidden\r\n     */\n    this.DEFAULT_CHAIN = Chain.Mainnet;\n    /**\r\n     * The default HF if the tx type is active on that HF\r\n     * or the first greater HF where the tx is active.\r\n     *\r\n     * @hidden\r\n     */\n    this.DEFAULT_HARDFORK = Hardfork.Merge;\n    const {\n      nonce,\n      gasLimit,\n      to,\n      value,\n      data,\n      v,\n      r,\n      s,\n      type\n    } = txData;\n    this._type = Number(uint8ArrayToBigInt(toUint8Array(type)));\n    this.txOptions = opts;\n    const toB = toUint8Array(to === '' ? '0x' : to);\n    const vB = toUint8Array(v === '' ? '0x' : v);\n    const rB = toUint8Array(r === '' ? '0x' : r);\n    const sB = toUint8Array(s === '' ? '0x' : s);\n    this.nonce = uint8ArrayToBigInt(toUint8Array(nonce === '' ? '0x' : nonce));\n    this.gasLimit = uint8ArrayToBigInt(toUint8Array(gasLimit === '' ? '0x' : gasLimit));\n    this.to = toB.length > 0 ? new Address(toB) : undefined;\n    this.value = uint8ArrayToBigInt(toUint8Array(value === '' ? '0x' : value));\n    this.data = toUint8Array(data === '' ? '0x' : data);\n    this.v = vB.length > 0 ? uint8ArrayToBigInt(vB) : undefined;\n    this.r = rB.length > 0 ? uint8ArrayToBigInt(rB) : undefined;\n    this.s = sB.length > 0 ? uint8ArrayToBigInt(sB) : undefined;\n    this._validateCannotExceedMaxInteger({\n      value: this.value,\n      r: this.r,\n      s: this.s\n    });\n    // geth limits gasLimit to 2^64-1\n    this._validateCannotExceedMaxInteger({\n      gasLimit: this.gasLimit\n    }, 64);\n    // EIP-2681 limits nonce to 2^64-1 (cannot equal 2^64-1)\n    this._validateCannotExceedMaxInteger({\n      nonce: this.nonce\n    }, 64, true);\n    // eslint-disable-next-line no-null/no-null\n    const createContract = this.to === undefined || this.to === null;\n    const allowUnlimitedInitCodeSize = (_a = opts.allowUnlimitedInitCodeSize) !== null && _a !== void 0 ? _a : false;\n    const common = (_b = opts.common) !== null && _b !== void 0 ? _b : this._getCommon();\n    if (createContract && common.isActivatedEIP(3860) && !allowUnlimitedInitCodeSize) {\n      checkMaxInitCodeSize(common, this.data.length);\n    }\n  }\n  /**\r\n   * Returns the transaction type.\r\n   *\r\n   * Note: legacy txs will return tx type `0`.\r\n   */\n  get type() {\n    return this._type;\n  }\n  /**\r\n   * Checks if a tx type defining capability is active\r\n   * on a tx, for example the EIP-1559 fee market mechanism\r\n   * or the EIP-2930 access list feature.\r\n   *\r\n   * Note that this is different from the tx type itself,\r\n   * so EIP-2930 access lists can very well be active\r\n   * on an EIP-1559 tx for example.\r\n   *\r\n   * This method can be useful for feature checks if the\r\n   * tx type is unknown (e.g. when instantiated with\r\n   * the tx factory).\r\n   *\r\n   * See `Capabilites` in the `types` module for a reference\r\n   * on all supported capabilities.\r\n   */\n  supports(capability) {\n    return this.activeCapabilities.includes(capability);\n  }\n  validate() {\n    let stringError = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    const errors = [];\n    if (this.getBaseFee() > this.gasLimit) {\n      errors.push(`gasLimit is too low. given ${this.gasLimit}, need at least ${this.getBaseFee()}`);\n    }\n    if (this.isSigned() && !this.verifySignature()) {\n      errors.push('Invalid Signature');\n    }\n    return stringError ? errors : errors.length === 0;\n  }\n  _validateYParity() {\n    const {\n      v\n    } = this;\n    if (v !== undefined && v !== BigInt(0) && v !== BigInt(1)) {\n      const msg = this._errorMsg('The y-parity of the transaction should either be 0 or 1');\n      throw new Error(msg);\n    }\n  }\n  /**\r\n   * EIP-2: All transaction signatures whose s-value is greater than secp256k1n/2are considered invalid.\r\n   * Reasoning: https://ethereum.stackexchange.com/a/55728\r\n   */\n  _validateHighS() {\n    const {\n      s\n    } = this;\n    if (this.common.gteHardfork('homestead') && s !== undefined && s > SECP256K1_ORDER_DIV_2) {\n      const msg = this._errorMsg('Invalid Signature: s-values greater than secp256k1n/2 are considered invalid');\n      throw new Error(msg);\n    }\n  }\n  /**\r\n   * The minimum amount of gas the tx must have (DataFee + TxFee + Creation Fee)\r\n   */\n  getBaseFee() {\n    const txFee = this.common.param('gasPrices', 'tx');\n    let fee = this.getDataFee();\n    if (txFee) fee += txFee;\n    if (this.common.gteHardfork('homestead') && this.toCreationAddress()) {\n      const txCreationFee = this.common.param('gasPrices', 'txCreation');\n      if (txCreationFee) fee += txCreationFee;\n    }\n    return fee;\n  }\n  /**\r\n   * The amount of gas paid for the data in this tx\r\n   */\n  getDataFee() {\n    const txDataZero = this.common.param('gasPrices', 'txDataZero');\n    const txDataNonZero = this.common.param('gasPrices', 'txDataNonZero');\n    let cost = BigInt(0);\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let i = 0; i < this.data.length; i += 1) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions, no-unused-expressions\n      this.data[i] === 0 ? cost += txDataZero : cost += txDataNonZero;\n    }\n    // eslint-disable-next-line no-null/no-null\n    if ((this.to === undefined || this.to === null) && this.common.isActivatedEIP(3860)) {\n      const dataLength = BigInt(Math.ceil(this.data.length / 32));\n      const initCodeCost = this.common.param('gasPrices', 'initCodeWordCost') * dataLength;\n      cost += initCodeCost;\n    }\n    return cost;\n  }\n  /**\r\n   * If the tx's `to` is to the creation address\r\n   */\n  toCreationAddress() {\n    return this.to === undefined || this.to.buf.length === 0;\n  }\n  isSigned() {\n    const {\n      v,\n      r,\n      s\n    } = this;\n    if (v === undefined || r === undefined || s === undefined) {\n      return false;\n    }\n    return true;\n  }\n  /**\r\n   * Determines if the signature is valid\r\n   */\n  verifySignature() {\n    try {\n      // Main signature verification is done in `getSenderPublicKey()`\n      const publicKey = this.getSenderPublicKey();\n      return unpadUint8Array(publicKey).length !== 0;\n    } catch (e) {\n      return false;\n    }\n  }\n  /**\r\n   * Returns the sender's address\r\n   */\n  getSenderAddress() {\n    return new Address(Address.publicToAddress(this.getSenderPublicKey()));\n  }\n  /**\r\n   * Signs a transaction.\r\n   *\r\n   * Note that the signed tx is returned as a new object,\r\n   * use as follows:\r\n   * ```javascript\r\n   * const signedTx = tx.sign(privateKey)\r\n   * ```\r\n   */\n  sign(privateKey) {\n    if (privateKey.length !== 32) {\n      const msg = this._errorMsg('Private key must be 32 bytes in length.');\n      throw new Error(msg);\n    }\n    // Hack for the constellation that we have got a legacy tx after spuriousDragon with a non-EIP155 conforming signature\n    // and want to recreate a signature (where EIP155 should be applied)\n    // Leaving this hack lets the legacy.spec.ts -> sign(), verifySignature() test fail\n    // 2021-06-23\n    let hackApplied = false;\n    if (this.type === 0 && this.common.gteHardfork('spuriousDragon') && !this.supports(Capability.EIP155ReplayProtection)) {\n      this.activeCapabilities.push(Capability.EIP155ReplayProtection);\n      hackApplied = true;\n    }\n    const msgHash = this.getMessageToSign(true);\n    const {\n      v,\n      r,\n      s\n    } = this._ecsign(msgHash, privateKey);\n    const tx = this._processSignature(v, r, s);\n    // Hack part 2\n    if (hackApplied) {\n      const index = this.activeCapabilities.indexOf(Capability.EIP155ReplayProtection);\n      if (index > -1) {\n        this.activeCapabilities.splice(index, 1);\n      }\n    }\n    return tx;\n  }\n  /**\r\n   * Does chain ID checks on common and returns a common\r\n   * to be used on instantiation\r\n   * @hidden\r\n   *\r\n   * @param common - {@link Common} instance from tx options\r\n   * @param chainId - Chain ID from tx options (typed txs) or signature (legacy tx)\r\n   */\n  _getCommon(common, chainId) {\n    var _a;\n    // Chain ID provided\n    if (chainId !== undefined) {\n      const chainIdBigInt = uint8ArrayToBigInt(toUint8Array(chainId));\n      if (common) {\n        if (common.chainId() !== chainIdBigInt) {\n          const msg = this._errorMsg('The chain ID does not match the chain ID of Common');\n          throw new Error(msg);\n        }\n        // Common provided, chain ID does match\n        // -> Return provided Common\n        return common.copy();\n      }\n      if (Common.isSupportedChainId(chainIdBigInt)) {\n        // No Common, chain ID supported by Common\n        // -> Instantiate Common with chain ID\n        return new Common({\n          chain: chainIdBigInt,\n          hardfork: this.DEFAULT_HARDFORK\n        });\n      }\n      // No Common, chain ID not supported by Common\n      // -> Instantiate custom Common derived from DEFAULT_CHAIN\n      return Common.custom({\n        name: 'custom-chain',\n        networkId: chainIdBigInt,\n        chainId: chainIdBigInt\n      }, {\n        baseChain: this.DEFAULT_CHAIN,\n        hardfork: this.DEFAULT_HARDFORK\n      });\n    }\n    // No chain ID provided\n    // -> return Common provided or create new default Common\n    return (_a = common === null || common === void 0 ? void 0 : common.copy()) !== null && _a !== void 0 ? _a : new Common({\n      chain: this.DEFAULT_CHAIN,\n      hardfork: this.DEFAULT_HARDFORK\n    });\n  }\n  /**\r\n   * Validates that an object with BigInt values cannot exceed the specified bit limit.\r\n   * @param values Object containing string keys and BigInt values\r\n   * @param bits Number of bits to check (64 or 256)\r\n   * @param cannotEqual Pass true if the number also cannot equal one less the maximum value\r\n   */\n  _validateCannotExceedMaxInteger(values) {\n    let bits = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 256;\n    let cannotEqual = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    for (const [key, value] of Object.entries(values)) {\n      switch (bits) {\n        case 64:\n          if (cannotEqual) {\n            if (value !== undefined && value >= MAX_UINT64) {\n              const msg = this._errorMsg(`${key} cannot equal or exceed MAX_UINT64 (2^64-1), given ${value}`);\n              throw new Error(msg);\n            }\n          } else if (value !== undefined && value > MAX_UINT64) {\n            const msg = this._errorMsg(`${key} cannot exceed MAX_UINT64 (2^64-1), given ${value}`);\n            throw new Error(msg);\n          }\n          break;\n        case 256:\n          if (cannotEqual) {\n            if (value !== undefined && value >= MAX_INTEGER) {\n              const msg = this._errorMsg(`${key} cannot equal or exceed MAX_INTEGER (2^256-1), given ${value}`);\n              throw new Error(msg);\n            }\n          } else if (value !== undefined && value > MAX_INTEGER) {\n            const msg = this._errorMsg(`${key} cannot exceed MAX_INTEGER (2^256-1), given ${value}`);\n            throw new Error(msg);\n          }\n          break;\n        default:\n          {\n            const msg = this._errorMsg('unimplemented bits value');\n            throw new Error(msg);\n          }\n      }\n    }\n  }\n  static _validateNotArray(values) {\n    const txDataKeys = ['nonce', 'gasPrice', 'gasLimit', 'to', 'value', 'data', 'v', 'r', 's', 'type', 'baseFee', 'maxFeePerGas', 'chainId'];\n    for (const [key, value] of Object.entries(values)) {\n      if (txDataKeys.includes(key)) {\n        if (Array.isArray(value)) {\n          throw new Error(`${key} cannot be an array`);\n        }\n      }\n    }\n  }\n  /**\r\n   * Returns the shared error postfix part for _error() method\r\n   * tx type implementations.\r\n   */\n  _getSharedErrorPostfix() {\n    let hash = '';\n    try {\n      hash = this.isSigned() ? bytesToHex(this.hash()) : 'not available (unsigned)';\n    } catch (e) {\n      hash = 'error';\n    }\n    let isSigned = '';\n    try {\n      isSigned = this.isSigned().toString();\n    } catch (e) {\n      hash = 'error';\n    }\n    let hf = '';\n    try {\n      hf = this.common.hardfork();\n    } catch (e) {\n      hf = 'error';\n    }\n    let postfix = `tx type=${this.type} hash=${hash} nonce=${this.nonce} value=${this.value} `;\n    postfix += `signed=${isSigned} hf=${hf}`;\n    return postfix;\n  }\n  // eslint-disable-next-line class-methods-use-this\n  _ecsign(msgHash, privateKey, chainId) {\n    const signature = secp256k1.sign(msgHash, privateKey);\n    const signatureBytes = signature.toCompactRawBytes();\n    const r = signatureBytes.subarray(0, 32);\n    const s = signatureBytes.subarray(32, 64);\n    const v = chainId === undefined ? BigInt(signature.recovery + 27) : BigInt(signature.recovery + 35) + BigInt(chainId) * BigInt(2);\n    return {\n      r,\n      s,\n      v\n    };\n  }\n}","map":{"version":3,"names":["bytesToHex","MAX_INTEGER","MAX_UINT64","SECP256K1_ORDER_DIV_2","secp256k1","Chain","Common","Hardfork","toUint8Array","uint8ArrayToBigInt","unpadUint8Array","Capability","Address","checkMaxInitCodeSize","BaseTransaction","constructor","txData","opts","cache","hash","undefined","dataFee","activeCapabilities","DEFAULT_CHAIN","Mainnet","DEFAULT_HARDFORK","Merge","nonce","gasLimit","to","value","data","v","r","s","type","_type","Number","txOptions","toB","vB","rB","sB","length","_validateCannotExceedMaxInteger","createContract","allowUnlimitedInitCodeSize","_a","common","_b","_getCommon","isActivatedEIP","supports","capability","includes","validate","stringError","arguments","errors","getBaseFee","push","isSigned","verifySignature","_validateYParity","BigInt","msg","_errorMsg","Error","_validateHighS","gteHardfork","txFee","param","fee","getDataFee","toCreationAddress","txCreationFee","txDataZero","txDataNonZero","cost","i","dataLength","Math","ceil","initCodeCost","buf","publicKey","getSenderPublicKey","e","getSenderAddress","publicToAddress","sign","privateKey","hackApplied","EIP155ReplayProtection","msgHash","getMessageToSign","_ecsign","tx","_processSignature","index","indexOf","splice","chainId","chainIdBigInt","copy","isSupportedChainId","chain","hardfork","custom","name","networkId","baseChain","values","bits","cannotEqual","key","Object","entries","_validateNotArray","txDataKeys","Array","isArray","_getSharedErrorPostfix","toString","hf","postfix","signature","signatureBytes","toCompactRawBytes","subarray","recovery"],"sources":["C:\\Users\\lakka\\OneDrive - Manipal Academy of Higher Education\\FIDUCIA\\voting-gui\\fiducia\\node_modules\\web3-eth-accounts\\src\\tx\\baseTransaction.ts"],"sourcesContent":["/*\r\nThis file is part of web3.js.\r\n\r\nweb3.js is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU Lesser General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nweb3.js is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\nGNU Lesser General Public License for more details.\r\n\r\nYou should have received a copy of the GNU Lesser General Public License\r\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n\r\nimport { Numbers } from 'web3-types';\r\nimport { bytesToHex } from 'web3-utils';\r\nimport { MAX_INTEGER, MAX_UINT64, SECP256K1_ORDER_DIV_2, secp256k1 } from './constants.js';\r\nimport {\r\n\tChain,\r\n\tCommon,\r\n\tHardfork,\r\n\ttoUint8Array,\r\n\tuint8ArrayToBigInt,\r\n\tunpadUint8Array,\r\n} from '../common/index.js';\r\nimport type {\r\n\tAccessListEIP2930TxData,\r\n\tAccessListEIP2930ValuesArray,\r\n\tFeeMarketEIP1559TxData,\r\n\tFeeMarketEIP1559ValuesArray,\r\n\tJsonTx,\r\n\tTxData,\r\n\tTxOptions,\r\n\tTxValuesArray,\r\n} from './types.js';\r\nimport { Capability, ECDSASignature } from './types.js';\r\nimport { Address } from './address.js';\r\nimport { checkMaxInitCodeSize } from './utils.js';\r\n\r\ninterface TransactionCache {\r\n\thash: Uint8Array | undefined;\r\n\tdataFee?: {\r\n\t\tvalue: bigint;\r\n\t\thardfork: string | Hardfork;\r\n\t};\r\n}\r\n\r\n/**\r\n * This base class will likely be subject to further\r\n * refactoring along the introduction of additional tx types\r\n * on the Ethereum network.\r\n *\r\n * It is therefore not recommended to use directly.\r\n */\r\nexport abstract class BaseTransaction<TransactionObject> {\r\n\tprivate readonly _type: number;\r\n\r\n\tpublic readonly nonce: bigint;\r\n\tpublic readonly gasLimit: bigint;\r\n\tpublic readonly to?: Address;\r\n\tpublic readonly value: bigint;\r\n\tpublic readonly data: Uint8Array;\r\n\r\n\tpublic readonly v?: bigint;\r\n\tpublic readonly r?: bigint;\r\n\tpublic readonly s?: bigint;\r\n\r\n\tpublic readonly common!: Common;\r\n\r\n\tprotected cache: TransactionCache = {\r\n\t\thash: undefined,\r\n\t\tdataFee: undefined,\r\n\t};\r\n\r\n\tprotected readonly txOptions: TxOptions;\r\n\r\n\t/**\r\n\t * List of tx type defining EIPs,\r\n\t * e.g. 1559 (fee market) and 2930 (access lists)\r\n\t * for FeeMarketEIP1559Transaction objects\r\n\t */\r\n\tprotected activeCapabilities: number[] = [];\r\n\r\n\t/**\r\n\t * The default chain the tx falls back to if no Common\r\n\t * is provided and if the chain can't be derived from\r\n\t * a passed in chainId (only EIP-2718 typed txs) or\r\n\t * EIP-155 signature (legacy txs).\r\n\t *\r\n\t * @hidden\r\n\t */\r\n\tprotected DEFAULT_CHAIN = Chain.Mainnet;\r\n\r\n\t/**\r\n\t * The default HF if the tx type is active on that HF\r\n\t * or the first greater HF where the tx is active.\r\n\t *\r\n\t * @hidden\r\n\t */\r\n\tprotected DEFAULT_HARDFORK: string | Hardfork = Hardfork.Merge;\r\n\r\n\tpublic constructor(\r\n\t\ttxData: TxData | AccessListEIP2930TxData | FeeMarketEIP1559TxData,\r\n\t\topts: TxOptions,\r\n\t) {\r\n\t\tconst { nonce, gasLimit, to, value, data, v, r, s, type } = txData;\r\n\t\tthis._type = Number(uint8ArrayToBigInt(toUint8Array(type)));\r\n\r\n\t\tthis.txOptions = opts;\r\n\r\n\t\tconst toB = toUint8Array(to === '' ? '0x' : to);\r\n\t\tconst vB = toUint8Array(v === '' ? '0x' : v);\r\n\t\tconst rB = toUint8Array(r === '' ? '0x' : r);\r\n\t\tconst sB = toUint8Array(s === '' ? '0x' : s);\r\n\r\n\t\tthis.nonce = uint8ArrayToBigInt(toUint8Array(nonce === '' ? '0x' : nonce));\r\n\t\tthis.gasLimit = uint8ArrayToBigInt(toUint8Array(gasLimit === '' ? '0x' : gasLimit));\r\n\t\tthis.to = toB.length > 0 ? new Address(toB) : undefined;\r\n\t\tthis.value = uint8ArrayToBigInt(toUint8Array(value === '' ? '0x' : value));\r\n\t\tthis.data = toUint8Array(data === '' ? '0x' : data);\r\n\r\n\t\tthis.v = vB.length > 0 ? uint8ArrayToBigInt(vB) : undefined;\r\n\t\tthis.r = rB.length > 0 ? uint8ArrayToBigInt(rB) : undefined;\r\n\t\tthis.s = sB.length > 0 ? uint8ArrayToBigInt(sB) : undefined;\r\n\r\n\t\tthis._validateCannotExceedMaxInteger({ value: this.value, r: this.r, s: this.s });\r\n\r\n\t\t// geth limits gasLimit to 2^64-1\r\n\t\tthis._validateCannotExceedMaxInteger({ gasLimit: this.gasLimit }, 64);\r\n\r\n\t\t// EIP-2681 limits nonce to 2^64-1 (cannot equal 2^64-1)\r\n\t\tthis._validateCannotExceedMaxInteger({ nonce: this.nonce }, 64, true);\r\n\t\t// eslint-disable-next-line no-null/no-null\r\n\t\tconst createContract = this.to === undefined || this.to === null;\r\n\t\tconst allowUnlimitedInitCodeSize = opts.allowUnlimitedInitCodeSize ?? false;\r\n\t\tconst common = opts.common ?? this._getCommon();\r\n\t\tif (createContract && common.isActivatedEIP(3860) && !allowUnlimitedInitCodeSize) {\r\n\t\t\tcheckMaxInitCodeSize(common, this.data.length);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the transaction type.\r\n\t *\r\n\t * Note: legacy txs will return tx type `0`.\r\n\t */\r\n\tpublic get type() {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if a tx type defining capability is active\r\n\t * on a tx, for example the EIP-1559 fee market mechanism\r\n\t * or the EIP-2930 access list feature.\r\n\t *\r\n\t * Note that this is different from the tx type itself,\r\n\t * so EIP-2930 access lists can very well be active\r\n\t * on an EIP-1559 tx for example.\r\n\t *\r\n\t * This method can be useful for feature checks if the\r\n\t * tx type is unknown (e.g. when instantiated with\r\n\t * the tx factory).\r\n\t *\r\n\t * See `Capabilites` in the `types` module for a reference\r\n\t * on all supported capabilities.\r\n\t */\r\n\tpublic supports(capability: Capability) {\r\n\t\treturn this.activeCapabilities.includes(capability);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the transaction has the minimum amount of gas required\r\n\t * (DataFee + TxFee + Creation Fee).\r\n\t */\r\n\tpublic validate(): boolean;\r\n\tpublic validate(stringError: false): boolean;\r\n\tpublic validate(stringError: true): string[];\r\n\tpublic validate(stringError = false): boolean | string[] {\r\n\t\tconst errors = [];\r\n\r\n\t\tif (this.getBaseFee() > this.gasLimit) {\r\n\t\t\terrors.push(\r\n\t\t\t\t`gasLimit is too low. given ${this.gasLimit}, need at least ${this.getBaseFee()}`,\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (this.isSigned() && !this.verifySignature()) {\r\n\t\t\terrors.push('Invalid Signature');\r\n\t\t}\r\n\r\n\t\treturn stringError ? errors : errors.length === 0;\r\n\t}\r\n\r\n\tprotected _validateYParity() {\r\n\t\tconst { v } = this;\r\n\t\tif (v !== undefined && v !== BigInt(0) && v !== BigInt(1)) {\r\n\t\t\tconst msg = this._errorMsg('The y-parity of the transaction should either be 0 or 1');\r\n\t\t\tthrow new Error(msg);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * EIP-2: All transaction signatures whose s-value is greater than secp256k1n/2are considered invalid.\r\n\t * Reasoning: https://ethereum.stackexchange.com/a/55728\r\n\t */\r\n\tprotected _validateHighS() {\r\n\t\tconst { s } = this;\r\n\t\tif (this.common.gteHardfork('homestead') && s !== undefined && s > SECP256K1_ORDER_DIV_2) {\r\n\t\t\tconst msg = this._errorMsg(\r\n\t\t\t\t'Invalid Signature: s-values greater than secp256k1n/2 are considered invalid',\r\n\t\t\t);\r\n\t\t\tthrow new Error(msg);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * The minimum amount of gas the tx must have (DataFee + TxFee + Creation Fee)\r\n\t */\r\n\tpublic getBaseFee(): bigint {\r\n\t\tconst txFee = this.common.param('gasPrices', 'tx');\r\n\t\tlet fee = this.getDataFee();\r\n\t\tif (txFee) fee += txFee;\r\n\t\tif (this.common.gteHardfork('homestead') && this.toCreationAddress()) {\r\n\t\t\tconst txCreationFee = this.common.param('gasPrices', 'txCreation');\r\n\t\t\tif (txCreationFee) fee += txCreationFee;\r\n\t\t}\r\n\t\treturn fee;\r\n\t}\r\n\r\n\t/**\r\n\t * The amount of gas paid for the data in this tx\r\n\t */\r\n\tpublic getDataFee(): bigint {\r\n\t\tconst txDataZero = this.common.param('gasPrices', 'txDataZero');\r\n\t\tconst txDataNonZero = this.common.param('gasPrices', 'txDataNonZero');\r\n\r\n\t\tlet cost = BigInt(0);\r\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\r\n\t\tfor (let i = 0; i < this.data.length; i += 1) {\r\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unused-expressions, no-unused-expressions\r\n\t\t\tthis.data[i] === 0 ? (cost += txDataZero) : (cost += txDataNonZero);\r\n\t\t}\r\n\t\t// eslint-disable-next-line no-null/no-null\r\n\t\tif ((this.to === undefined || this.to === null) && this.common.isActivatedEIP(3860)) {\r\n\t\t\tconst dataLength = BigInt(Math.ceil(this.data.length / 32));\r\n\t\t\tconst initCodeCost = this.common.param('gasPrices', 'initCodeWordCost') * dataLength;\r\n\t\t\tcost += initCodeCost;\r\n\t\t}\r\n\r\n\t\treturn cost;\r\n\t}\r\n\r\n\t/**\r\n\t * The up front amount that an account must have for this transaction to be valid\r\n\t */\r\n\tpublic abstract getUpfrontCost(): bigint;\r\n\r\n\t/**\r\n\t * If the tx's `to` is to the creation address\r\n\t */\r\n\tpublic toCreationAddress(): boolean {\r\n\t\treturn this.to === undefined || this.to.buf.length === 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a Uint8Array Array of the raw Uint8Arrays of this transaction, in order.\r\n\t *\r\n\t * Use {@link BaseTransaction.serialize} to add a transaction to a block\r\n\t * with {@link Block.fromValuesArray}.\r\n\t *\r\n\t * For an unsigned tx this method uses the empty Uint8Array values for the\r\n\t * signature parameters `v`, `r` and `s` for encoding. For an EIP-155 compliant\r\n\t * representation for external signing use {@link BaseTransaction.getMessageToSign}.\r\n\t */\r\n\tpublic abstract raw():\r\n\t\t| TxValuesArray\r\n\t\t| AccessListEIP2930ValuesArray\r\n\t\t| FeeMarketEIP1559ValuesArray;\r\n\r\n\t/**\r\n\t * Returns the encoding of the transaction.\r\n\t */\r\n\tpublic abstract serialize(): Uint8Array;\r\n\r\n\t// Returns the unsigned tx (hashed or raw), which is used to sign the transaction.\r\n\t//\r\n\t// Note: do not use code docs here since VS Studio is then not able to detect the\r\n\t// comments from the inherited methods\r\n\tpublic abstract getMessageToSign(hashMessage: false): Uint8Array | Uint8Array[];\r\n\tpublic abstract getMessageToSign(hashMessage?: true): Uint8Array;\r\n\r\n\tpublic abstract hash(): Uint8Array;\r\n\r\n\tpublic abstract getMessageToVerifySignature(): Uint8Array;\r\n\r\n\tpublic isSigned(): boolean {\r\n\t\tconst { v, r, s } = this;\r\n\t\tif (v === undefined || r === undefined || s === undefined) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Determines if the signature is valid\r\n\t */\r\n\tpublic verifySignature(): boolean {\r\n\t\ttry {\r\n\t\t\t// Main signature verification is done in `getSenderPublicKey()`\r\n\t\t\tconst publicKey = this.getSenderPublicKey();\r\n\t\t\treturn unpadUint8Array(publicKey).length !== 0;\r\n\t\t} catch (e: any) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the sender's address\r\n\t */\r\n\tpublic getSenderAddress(): Address {\r\n\t\treturn new Address(Address.publicToAddress(this.getSenderPublicKey()));\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the public key of the sender\r\n\t */\r\n\tpublic abstract getSenderPublicKey(): Uint8Array;\r\n\r\n\t/**\r\n\t * Signs a transaction.\r\n\t *\r\n\t * Note that the signed tx is returned as a new object,\r\n\t * use as follows:\r\n\t * ```javascript\r\n\t * const signedTx = tx.sign(privateKey)\r\n\t * ```\r\n\t */\r\n\tpublic sign(privateKey: Uint8Array): TransactionObject {\r\n\t\tif (privateKey.length !== 32) {\r\n\t\t\tconst msg = this._errorMsg('Private key must be 32 bytes in length.');\r\n\t\t\tthrow new Error(msg);\r\n\t\t}\r\n\r\n\t\t// Hack for the constellation that we have got a legacy tx after spuriousDragon with a non-EIP155 conforming signature\r\n\t\t// and want to recreate a signature (where EIP155 should be applied)\r\n\t\t// Leaving this hack lets the legacy.spec.ts -> sign(), verifySignature() test fail\r\n\t\t// 2021-06-23\r\n\t\tlet hackApplied = false;\r\n\t\tif (\r\n\t\t\tthis.type === 0 &&\r\n\t\t\tthis.common.gteHardfork('spuriousDragon') &&\r\n\t\t\t!this.supports(Capability.EIP155ReplayProtection)\r\n\t\t) {\r\n\t\t\tthis.activeCapabilities.push(Capability.EIP155ReplayProtection);\r\n\t\t\thackApplied = true;\r\n\t\t}\r\n\r\n\t\tconst msgHash = this.getMessageToSign(true);\r\n\t\tconst { v, r, s } = this._ecsign(msgHash, privateKey);\r\n\t\tconst tx = this._processSignature(v, r, s);\r\n\r\n\t\t// Hack part 2\r\n\t\tif (hackApplied) {\r\n\t\t\tconst index = this.activeCapabilities.indexOf(Capability.EIP155ReplayProtection);\r\n\t\t\tif (index > -1) {\r\n\t\t\t\tthis.activeCapabilities.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn tx;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an object with the JSON representation of the transaction\r\n\t */\r\n\tpublic abstract toJSON(): JsonTx;\r\n\r\n\t// Accept the v,r,s values from the `sign` method, and convert this into a TransactionObject\r\n\tprotected abstract _processSignature(\r\n\t\tv: bigint,\r\n\t\tr: Uint8Array,\r\n\t\ts: Uint8Array,\r\n\t): TransactionObject;\r\n\r\n\t/**\r\n\t * Does chain ID checks on common and returns a common\r\n\t * to be used on instantiation\r\n\t * @hidden\r\n\t *\r\n\t * @param common - {@link Common} instance from tx options\r\n\t * @param chainId - Chain ID from tx options (typed txs) or signature (legacy tx)\r\n\t */\r\n\tprotected _getCommon(common?: Common, chainId?: Numbers) {\r\n\t\t// Chain ID provided\r\n\t\tif (chainId !== undefined) {\r\n\t\t\tconst chainIdBigInt = uint8ArrayToBigInt(toUint8Array(chainId));\r\n\t\t\tif (common) {\r\n\t\t\t\tif (common.chainId() !== chainIdBigInt) {\r\n\t\t\t\t\tconst msg = this._errorMsg(\r\n\t\t\t\t\t\t'The chain ID does not match the chain ID of Common',\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthrow new Error(msg);\r\n\t\t\t\t}\r\n\t\t\t\t// Common provided, chain ID does match\r\n\t\t\t\t// -> Return provided Common\r\n\t\t\t\treturn common.copy();\r\n\t\t\t}\r\n\t\t\tif (Common.isSupportedChainId(chainIdBigInt)) {\r\n\t\t\t\t// No Common, chain ID supported by Common\r\n\t\t\t\t// -> Instantiate Common with chain ID\r\n\t\t\t\treturn new Common({ chain: chainIdBigInt, hardfork: this.DEFAULT_HARDFORK });\r\n\t\t\t}\r\n\t\t\t// No Common, chain ID not supported by Common\r\n\t\t\t// -> Instantiate custom Common derived from DEFAULT_CHAIN\r\n\t\t\treturn Common.custom(\r\n\t\t\t\t{\r\n\t\t\t\t\tname: 'custom-chain',\r\n\t\t\t\t\tnetworkId: chainIdBigInt,\r\n\t\t\t\t\tchainId: chainIdBigInt,\r\n\t\t\t\t},\r\n\t\t\t\t{ baseChain: this.DEFAULT_CHAIN, hardfork: this.DEFAULT_HARDFORK },\r\n\t\t\t);\r\n\t\t}\r\n\t\t// No chain ID provided\r\n\t\t// -> return Common provided or create new default Common\r\n\t\treturn (\r\n\t\t\tcommon?.copy() ??\r\n\t\t\tnew Common({ chain: this.DEFAULT_CHAIN, hardfork: this.DEFAULT_HARDFORK })\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Validates that an object with BigInt values cannot exceed the specified bit limit.\r\n\t * @param values Object containing string keys and BigInt values\r\n\t * @param bits Number of bits to check (64 or 256)\r\n\t * @param cannotEqual Pass true if the number also cannot equal one less the maximum value\r\n\t */\r\n\tprotected _validateCannotExceedMaxInteger(\r\n\t\tvalues: { [key: string]: bigint | undefined },\r\n\t\tbits = 256,\r\n\t\tcannotEqual = false,\r\n\t) {\r\n\t\tfor (const [key, value] of Object.entries(values)) {\r\n\t\t\tswitch (bits) {\r\n\t\t\t\tcase 64:\r\n\t\t\t\t\tif (cannotEqual) {\r\n\t\t\t\t\t\tif (value !== undefined && value >= MAX_UINT64) {\r\n\t\t\t\t\t\t\tconst msg = this._errorMsg(\r\n\t\t\t\t\t\t\t\t`${key} cannot equal or exceed MAX_UINT64 (2^64-1), given ${value}`,\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tthrow new Error(msg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (value !== undefined && value > MAX_UINT64) {\r\n\t\t\t\t\t\tconst msg = this._errorMsg(\r\n\t\t\t\t\t\t\t`${key} cannot exceed MAX_UINT64 (2^64-1), given ${value}`,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tthrow new Error(msg);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 256:\r\n\t\t\t\t\tif (cannotEqual) {\r\n\t\t\t\t\t\tif (value !== undefined && value >= MAX_INTEGER) {\r\n\t\t\t\t\t\t\tconst msg = this._errorMsg(\r\n\t\t\t\t\t\t\t\t`${key} cannot equal or exceed MAX_INTEGER (2^256-1), given ${value}`,\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tthrow new Error(msg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (value !== undefined && value > MAX_INTEGER) {\r\n\t\t\t\t\t\tconst msg = this._errorMsg(\r\n\t\t\t\t\t\t\t`${key} cannot exceed MAX_INTEGER (2^256-1), given ${value}`,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tthrow new Error(msg);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault: {\r\n\t\t\t\t\tconst msg = this._errorMsg('unimplemented bits value');\r\n\t\t\t\t\tthrow new Error(msg);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected static _validateNotArray(values: { [key: string]: any }) {\r\n\t\tconst txDataKeys = [\r\n\t\t\t'nonce',\r\n\t\t\t'gasPrice',\r\n\t\t\t'gasLimit',\r\n\t\t\t'to',\r\n\t\t\t'value',\r\n\t\t\t'data',\r\n\t\t\t'v',\r\n\t\t\t'r',\r\n\t\t\t's',\r\n\t\t\t'type',\r\n\t\t\t'baseFee',\r\n\t\t\t'maxFeePerGas',\r\n\t\t\t'chainId',\r\n\t\t];\r\n\t\tfor (const [key, value] of Object.entries(values)) {\r\n\t\t\tif (txDataKeys.includes(key)) {\r\n\t\t\t\tif (Array.isArray(value)) {\r\n\t\t\t\t\tthrow new Error(`${key} cannot be an array`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Return a compact error string representation of the object\r\n\t */\r\n\tpublic abstract errorStr(): string;\r\n\r\n\t/**\r\n\t * Internal helper function to create an annotated error message\r\n\t *\r\n\t * @param msg Base error message\r\n\t * @hidden\r\n\t */\r\n\tprotected abstract _errorMsg(msg: string): string;\r\n\r\n\t/**\r\n\t * Returns the shared error postfix part for _error() method\r\n\t * tx type implementations.\r\n\t */\r\n\tprotected _getSharedErrorPostfix() {\r\n\t\tlet hash = '';\r\n\t\ttry {\r\n\t\t\thash = this.isSigned() ? bytesToHex(this.hash()) : 'not available (unsigned)';\r\n\t\t} catch (e: any) {\r\n\t\t\thash = 'error';\r\n\t\t}\r\n\t\tlet isSigned = '';\r\n\t\ttry {\r\n\t\t\tisSigned = this.isSigned().toString();\r\n\t\t} catch (e: any) {\r\n\t\t\thash = 'error';\r\n\t\t}\r\n\t\tlet hf = '';\r\n\t\ttry {\r\n\t\t\thf = this.common.hardfork();\r\n\t\t} catch (e: any) {\r\n\t\t\thf = 'error';\r\n\t\t}\r\n\r\n\t\tlet postfix = `tx type=${this.type} hash=${hash} nonce=${this.nonce} value=${this.value} `;\r\n\t\tpostfix += `signed=${isSigned} hf=${hf}`;\r\n\r\n\t\treturn postfix;\r\n\t}\r\n\t// eslint-disable-next-line class-methods-use-this\r\n\tprivate _ecsign(msgHash: Uint8Array, privateKey: Uint8Array, chainId?: bigint): ECDSASignature {\r\n\t\tconst signature = secp256k1.sign(msgHash, privateKey);\r\n\t\tconst signatureBytes = signature.toCompactRawBytes();\r\n\r\n\t\tconst r = signatureBytes.subarray(0, 32);\r\n\t\tconst s = signatureBytes.subarray(32, 64);\r\n\r\n\t\tconst v =\r\n\t\t\tchainId === undefined\r\n\t\t\t\t? BigInt(signature.recovery! + 27)\r\n\t\t\t\t: BigInt(signature.recovery! + 35) + BigInt(chainId) * BigInt(2);\r\n\r\n\t\treturn { r, s, v };\r\n\t}\r\n}\r\n"],"mappings":"AAAA;;;;;;;;;;;;;;;;AAkBA,SAASA,UAAU,QAAQ,YAAY;AACvC,SAASC,WAAW,EAAEC,UAAU,EAAEC,qBAAqB,EAAEC,SAAS,QAAQ,gBAAgB;AAC1F,SACCC,KAAK,EACLC,MAAM,EACNC,QAAQ,EACRC,YAAY,EACZC,kBAAkB,EAClBC,eAAe,QACT,oBAAoB;AAW3B,SAASC,UAAU,QAAwB,YAAY;AACvD,SAASC,OAAO,QAAQ,cAAc;AACtC,SAASC,oBAAoB,QAAQ,YAAY;AAUjD;;;;;;;AAOA,OAAM,MAAgBC,eAAe;EA+CpCC,YACCC,MAAiE,EACjEC,IAAe;;IAlCN,KAAAC,KAAK,GAAqB;MACnCC,IAAI,EAAEC,SAAS;MACfC,OAAO,EAAED;KACT;IAID;;;;;IAKU,KAAAE,kBAAkB,GAAa,EAAE;IAE3C;;;;;;;;IAQU,KAAAC,aAAa,GAAGlB,KAAK,CAACmB,OAAO;IAEvC;;;;;;IAMU,KAAAC,gBAAgB,GAAsBlB,QAAQ,CAACmB,KAAK;IAM7D,MAAM;MAAEC,KAAK;MAAEC,QAAQ;MAAEC,EAAE;MAAEC,KAAK;MAAEC,IAAI;MAAEC,CAAC;MAAEC,CAAC;MAAEC,CAAC;MAAEC;IAAI,CAAE,GAAGnB,MAAM;IAClE,IAAI,CAACoB,KAAK,GAAGC,MAAM,CAAC5B,kBAAkB,CAACD,YAAY,CAAC2B,IAAI,CAAC,CAAC,CAAC;IAE3D,IAAI,CAACG,SAAS,GAAGrB,IAAI;IAErB,MAAMsB,GAAG,GAAG/B,YAAY,CAACqB,EAAE,KAAK,EAAE,GAAG,IAAI,GAAGA,EAAE,CAAC;IAC/C,MAAMW,EAAE,GAAGhC,YAAY,CAACwB,CAAC,KAAK,EAAE,GAAG,IAAI,GAAGA,CAAC,CAAC;IAC5C,MAAMS,EAAE,GAAGjC,YAAY,CAACyB,CAAC,KAAK,EAAE,GAAG,IAAI,GAAGA,CAAC,CAAC;IAC5C,MAAMS,EAAE,GAAGlC,YAAY,CAAC0B,CAAC,KAAK,EAAE,GAAG,IAAI,GAAGA,CAAC,CAAC;IAE5C,IAAI,CAACP,KAAK,GAAGlB,kBAAkB,CAACD,YAAY,CAACmB,KAAK,KAAK,EAAE,GAAG,IAAI,GAAGA,KAAK,CAAC,CAAC;IAC1E,IAAI,CAACC,QAAQ,GAAGnB,kBAAkB,CAACD,YAAY,CAACoB,QAAQ,KAAK,EAAE,GAAG,IAAI,GAAGA,QAAQ,CAAC,CAAC;IACnF,IAAI,CAACC,EAAE,GAAGU,GAAG,CAACI,MAAM,GAAG,CAAC,GAAG,IAAI/B,OAAO,CAAC2B,GAAG,CAAC,GAAGnB,SAAS;IACvD,IAAI,CAACU,KAAK,GAAGrB,kBAAkB,CAACD,YAAY,CAACsB,KAAK,KAAK,EAAE,GAAG,IAAI,GAAGA,KAAK,CAAC,CAAC;IAC1E,IAAI,CAACC,IAAI,GAAGvB,YAAY,CAACuB,IAAI,KAAK,EAAE,GAAG,IAAI,GAAGA,IAAI,CAAC;IAEnD,IAAI,CAACC,CAAC,GAAGQ,EAAE,CAACG,MAAM,GAAG,CAAC,GAAGlC,kBAAkB,CAAC+B,EAAE,CAAC,GAAGpB,SAAS;IAC3D,IAAI,CAACa,CAAC,GAAGQ,EAAE,CAACE,MAAM,GAAG,CAAC,GAAGlC,kBAAkB,CAACgC,EAAE,CAAC,GAAGrB,SAAS;IAC3D,IAAI,CAACc,CAAC,GAAGQ,EAAE,CAACC,MAAM,GAAG,CAAC,GAAGlC,kBAAkB,CAACiC,EAAE,CAAC,GAAGtB,SAAS;IAE3D,IAAI,CAACwB,+BAA+B,CAAC;MAAEd,KAAK,EAAE,IAAI,CAACA,KAAK;MAAEG,CAAC,EAAE,IAAI,CAACA,CAAC;MAAEC,CAAC,EAAE,IAAI,CAACA;IAAC,CAAE,CAAC;IAEjF;IACA,IAAI,CAACU,+BAA+B,CAAC;MAAEhB,QAAQ,EAAE,IAAI,CAACA;IAAQ,CAAE,EAAE,EAAE,CAAC;IAErE;IACA,IAAI,CAACgB,+BAA+B,CAAC;MAAEjB,KAAK,EAAE,IAAI,CAACA;IAAK,CAAE,EAAE,EAAE,EAAE,IAAI,CAAC;IACrE;IACA,MAAMkB,cAAc,GAAG,IAAI,CAAChB,EAAE,KAAKT,SAAS,IAAI,IAAI,CAACS,EAAE,KAAK,IAAI;IAChE,MAAMiB,0BAA0B,GAAG,CAAAC,EAAA,GAAA9B,IAAI,CAAC6B,0BAA0B,cAAAC,EAAA,cAAAA,EAAA,GAAI,KAAK;IAC3E,MAAMC,MAAM,GAAG,CAAAC,EAAA,GAAAhC,IAAI,CAAC+B,MAAM,cAAAC,EAAA,cAAAA,EAAA,GAAI,IAAI,CAACC,UAAU,EAAE;IAC/C,IAAIL,cAAc,IAAIG,MAAM,CAACG,cAAc,CAAC,IAAI,CAAC,IAAI,CAACL,0BAA0B,EAAE;MACjFjC,oBAAoB,CAACmC,MAAM,EAAE,IAAI,CAACjB,IAAI,CAACY,MAAM,CAAC;;EAEhD;EAEA;;;;;EAKA,IAAWR,IAAIA,CAAA;IACd,OAAO,IAAI,CAACC,KAAK;EAClB;EAEA;;;;;;;;;;;;;;;;EAgBOgB,QAAQA,CAACC,UAAsB;IACrC,OAAO,IAAI,CAAC/B,kBAAkB,CAACgC,QAAQ,CAACD,UAAU,CAAC;EACpD;EASOE,QAAQA,CAAA,EAAoB;IAAA,IAAnBC,WAAW,GAAAC,SAAA,CAAAd,MAAA,QAAAc,SAAA,QAAArC,SAAA,GAAAqC,SAAA,MAAG,KAAK;IAClC,MAAMC,MAAM,GAAG,EAAE;IAEjB,IAAI,IAAI,CAACC,UAAU,EAAE,GAAG,IAAI,CAAC/B,QAAQ,EAAE;MACtC8B,MAAM,CAACE,IAAI,CACV,8BAA8B,IAAI,CAAChC,QAAQ,mBAAmB,IAAI,CAAC+B,UAAU,EAAE,EAAE,CACjF;;IAGF,IAAI,IAAI,CAACE,QAAQ,EAAE,IAAI,CAAC,IAAI,CAACC,eAAe,EAAE,EAAE;MAC/CJ,MAAM,CAACE,IAAI,CAAC,mBAAmB,CAAC;;IAGjC,OAAOJ,WAAW,GAAGE,MAAM,GAAGA,MAAM,CAACf,MAAM,KAAK,CAAC;EAClD;EAEUoB,gBAAgBA,CAAA;IACzB,MAAM;MAAE/B;IAAC,CAAE,GAAG,IAAI;IAClB,IAAIA,CAAC,KAAKZ,SAAS,IAAIY,CAAC,KAAKgC,MAAM,CAAC,CAAC,CAAC,IAAIhC,CAAC,KAAKgC,MAAM,CAAC,CAAC,CAAC,EAAE;MAC1D,MAAMC,GAAG,GAAG,IAAI,CAACC,SAAS,CAAC,yDAAyD,CAAC;MACrF,MAAM,IAAIC,KAAK,CAACF,GAAG,CAAC;;EAEtB;EAEA;;;;EAIUG,cAAcA,CAAA;IACvB,MAAM;MAAElC;IAAC,CAAE,GAAG,IAAI;IAClB,IAAI,IAAI,CAACc,MAAM,CAACqB,WAAW,CAAC,WAAW,CAAC,IAAInC,CAAC,KAAKd,SAAS,IAAIc,CAAC,GAAG/B,qBAAqB,EAAE;MACzF,MAAM8D,GAAG,GAAG,IAAI,CAACC,SAAS,CACzB,8EAA8E,CAC9E;MACD,MAAM,IAAIC,KAAK,CAACF,GAAG,CAAC;;EAEtB;EAEA;;;EAGON,UAAUA,CAAA;IAChB,MAAMW,KAAK,GAAG,IAAI,CAACtB,MAAM,CAACuB,KAAK,CAAC,WAAW,EAAE,IAAI,CAAC;IAClD,IAAIC,GAAG,GAAG,IAAI,CAACC,UAAU,EAAE;IAC3B,IAAIH,KAAK,EAAEE,GAAG,IAAIF,KAAK;IACvB,IAAI,IAAI,CAACtB,MAAM,CAACqB,WAAW,CAAC,WAAW,CAAC,IAAI,IAAI,CAACK,iBAAiB,EAAE,EAAE;MACrE,MAAMC,aAAa,GAAG,IAAI,CAAC3B,MAAM,CAACuB,KAAK,CAAC,WAAW,EAAE,YAAY,CAAC;MAClE,IAAII,aAAa,EAAEH,GAAG,IAAIG,aAAa;;IAExC,OAAOH,GAAG;EACX;EAEA;;;EAGOC,UAAUA,CAAA;IAChB,MAAMG,UAAU,GAAG,IAAI,CAAC5B,MAAM,CAACuB,KAAK,CAAC,WAAW,EAAE,YAAY,CAAC;IAC/D,MAAMM,aAAa,GAAG,IAAI,CAAC7B,MAAM,CAACuB,KAAK,CAAC,WAAW,EAAE,eAAe,CAAC;IAErE,IAAIO,IAAI,GAAGd,MAAM,CAAC,CAAC,CAAC;IACpB;IACA,KAAK,IAAIe,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAAChD,IAAI,CAACY,MAAM,EAAEoC,CAAC,IAAI,CAAC,EAAE;MAC7C;MACA,IAAI,CAAChD,IAAI,CAACgD,CAAC,CAAC,KAAK,CAAC,GAAID,IAAI,IAAIF,UAAU,GAAKE,IAAI,IAAID,aAAc;;IAEpE;IACA,IAAI,CAAC,IAAI,CAAChD,EAAE,KAAKT,SAAS,IAAI,IAAI,CAACS,EAAE,KAAK,IAAI,KAAK,IAAI,CAACmB,MAAM,CAACG,cAAc,CAAC,IAAI,CAAC,EAAE;MACpF,MAAM6B,UAAU,GAAGhB,MAAM,CAACiB,IAAI,CAACC,IAAI,CAAC,IAAI,CAACnD,IAAI,CAACY,MAAM,GAAG,EAAE,CAAC,CAAC;MAC3D,MAAMwC,YAAY,GAAG,IAAI,CAACnC,MAAM,CAACuB,KAAK,CAAC,WAAW,EAAE,kBAAkB,CAAC,GAAGS,UAAU;MACpFF,IAAI,IAAIK,YAAY;;IAGrB,OAAOL,IAAI;EACZ;EAOA;;;EAGOJ,iBAAiBA,CAAA;IACvB,OAAO,IAAI,CAAC7C,EAAE,KAAKT,SAAS,IAAI,IAAI,CAACS,EAAE,CAACuD,GAAG,CAACzC,MAAM,KAAK,CAAC;EACzD;EAiCOkB,QAAQA,CAAA;IACd,MAAM;MAAE7B,CAAC;MAAEC,CAAC;MAAEC;IAAC,CAAE,GAAG,IAAI;IACxB,IAAIF,CAAC,KAAKZ,SAAS,IAAIa,CAAC,KAAKb,SAAS,IAAIc,CAAC,KAAKd,SAAS,EAAE;MAC1D,OAAO,KAAK;;IAEb,OAAO,IAAI;EACZ;EAEA;;;EAGO0C,eAAeA,CAAA;IACrB,IAAI;MACH;MACA,MAAMuB,SAAS,GAAG,IAAI,CAACC,kBAAkB,EAAE;MAC3C,OAAO5E,eAAe,CAAC2E,SAAS,CAAC,CAAC1C,MAAM,KAAK,CAAC;KAC9C,CAAC,OAAO4C,CAAM,EAAE;MAChB,OAAO,KAAK;;EAEd;EAEA;;;EAGOC,gBAAgBA,CAAA;IACtB,OAAO,IAAI5E,OAAO,CAACA,OAAO,CAAC6E,eAAe,CAAC,IAAI,CAACH,kBAAkB,EAAE,CAAC,CAAC;EACvE;EAOA;;;;;;;;;EASOI,IAAIA,CAACC,UAAsB;IACjC,IAAIA,UAAU,CAAChD,MAAM,KAAK,EAAE,EAAE;MAC7B,MAAMsB,GAAG,GAAG,IAAI,CAACC,SAAS,CAAC,yCAAyC,CAAC;MACrE,MAAM,IAAIC,KAAK,CAACF,GAAG,CAAC;;IAGrB;IACA;IACA;IACA;IACA,IAAI2B,WAAW,GAAG,KAAK;IACvB,IACC,IAAI,CAACzD,IAAI,KAAK,CAAC,IACf,IAAI,CAACa,MAAM,CAACqB,WAAW,CAAC,gBAAgB,CAAC,IACzC,CAAC,IAAI,CAACjB,QAAQ,CAACzC,UAAU,CAACkF,sBAAsB,CAAC,EAChD;MACD,IAAI,CAACvE,kBAAkB,CAACsC,IAAI,CAACjD,UAAU,CAACkF,sBAAsB,CAAC;MAC/DD,WAAW,GAAG,IAAI;;IAGnB,MAAME,OAAO,GAAG,IAAI,CAACC,gBAAgB,CAAC,IAAI,CAAC;IAC3C,MAAM;MAAE/D,CAAC;MAAEC,CAAC;MAAEC;IAAC,CAAE,GAAG,IAAI,CAAC8D,OAAO,CAACF,OAAO,EAAEH,UAAU,CAAC;IACrD,MAAMM,EAAE,GAAG,IAAI,CAACC,iBAAiB,CAAClE,CAAC,EAAEC,CAAC,EAAEC,CAAC,CAAC;IAE1C;IACA,IAAI0D,WAAW,EAAE;MAChB,MAAMO,KAAK,GAAG,IAAI,CAAC7E,kBAAkB,CAAC8E,OAAO,CAACzF,UAAU,CAACkF,sBAAsB,CAAC;MAChF,IAAIM,KAAK,GAAG,CAAC,CAAC,EAAE;QACf,IAAI,CAAC7E,kBAAkB,CAAC+E,MAAM,CAACF,KAAK,EAAE,CAAC,CAAC;;;IAI1C,OAAOF,EAAE;EACV;EAcA;;;;;;;;EAQU/C,UAAUA,CAACF,MAAe,EAAEsD,OAAiB;;IACtD;IACA,IAAIA,OAAO,KAAKlF,SAAS,EAAE;MAC1B,MAAMmF,aAAa,GAAG9F,kBAAkB,CAACD,YAAY,CAAC8F,OAAO,CAAC,CAAC;MAC/D,IAAItD,MAAM,EAAE;QACX,IAAIA,MAAM,CAACsD,OAAO,EAAE,KAAKC,aAAa,EAAE;UACvC,MAAMtC,GAAG,GAAG,IAAI,CAACC,SAAS,CACzB,oDAAoD,CACpD;UACD,MAAM,IAAIC,KAAK,CAACF,GAAG,CAAC;;QAErB;QACA;QACA,OAAOjB,MAAM,CAACwD,IAAI,EAAE;;MAErB,IAAIlG,MAAM,CAACmG,kBAAkB,CAACF,aAAa,CAAC,EAAE;QAC7C;QACA;QACA,OAAO,IAAIjG,MAAM,CAAC;UAAEoG,KAAK,EAAEH,aAAa;UAAEI,QAAQ,EAAE,IAAI,CAAClF;QAAgB,CAAE,CAAC;;MAE7E;MACA;MACA,OAAOnB,MAAM,CAACsG,MAAM,CACnB;QACCC,IAAI,EAAE,cAAc;QACpBC,SAAS,EAAEP,aAAa;QACxBD,OAAO,EAAEC;OACT,EACD;QAAEQ,SAAS,EAAE,IAAI,CAACxF,aAAa;QAAEoF,QAAQ,EAAE,IAAI,CAAClF;MAAgB,CAAE,CAClE;;IAEF;IACA;IACA,OACC,CAAAsB,EAAA,GAAAC,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEwD,IAAI,EAAE,cAAAzD,EAAA,cAAAA,EAAA,GACd,IAAIzC,MAAM,CAAC;MAAEoG,KAAK,EAAE,IAAI,CAACnF,aAAa;MAAEoF,QAAQ,EAAE,IAAI,CAAClF;IAAgB,CAAE,CAAC;EAE5E;EAEA;;;;;;EAMUmB,+BAA+BA,CACxCoE,MAA6C,EAE1B;IAAA,IADnBC,IAAI,GAAAxD,SAAA,CAAAd,MAAA,QAAAc,SAAA,QAAArC,SAAA,GAAAqC,SAAA,MAAG,GAAG;IAAA,IACVyD,WAAW,GAAAzD,SAAA,CAAAd,MAAA,QAAAc,SAAA,QAAArC,SAAA,GAAAqC,SAAA,MAAG,KAAK;IAEnB,KAAK,MAAM,CAAC0D,GAAG,EAAErF,KAAK,CAAC,IAAIsF,MAAM,CAACC,OAAO,CAACL,MAAM,CAAC,EAAE;MAClD,QAAQC,IAAI;QACX,KAAK,EAAE;UACN,IAAIC,WAAW,EAAE;YAChB,IAAIpF,KAAK,KAAKV,SAAS,IAAIU,KAAK,IAAI5B,UAAU,EAAE;cAC/C,MAAM+D,GAAG,GAAG,IAAI,CAACC,SAAS,CACzB,GAAGiD,GAAG,sDAAsDrF,KAAK,EAAE,CACnE;cACD,MAAM,IAAIqC,KAAK,CAACF,GAAG,CAAC;;WAErB,MAAM,IAAInC,KAAK,KAAKV,SAAS,IAAIU,KAAK,GAAG5B,UAAU,EAAE;YACrD,MAAM+D,GAAG,GAAG,IAAI,CAACC,SAAS,CACzB,GAAGiD,GAAG,6CAA6CrF,KAAK,EAAE,CAC1D;YACD,MAAM,IAAIqC,KAAK,CAACF,GAAG,CAAC;;UAErB;QACD,KAAK,GAAG;UACP,IAAIiD,WAAW,EAAE;YAChB,IAAIpF,KAAK,KAAKV,SAAS,IAAIU,KAAK,IAAI7B,WAAW,EAAE;cAChD,MAAMgE,GAAG,GAAG,IAAI,CAACC,SAAS,CACzB,GAAGiD,GAAG,wDAAwDrF,KAAK,EAAE,CACrE;cACD,MAAM,IAAIqC,KAAK,CAACF,GAAG,CAAC;;WAErB,MAAM,IAAInC,KAAK,KAAKV,SAAS,IAAIU,KAAK,GAAG7B,WAAW,EAAE;YACtD,MAAMgE,GAAG,GAAG,IAAI,CAACC,SAAS,CACzB,GAAGiD,GAAG,+CAA+CrF,KAAK,EAAE,CAC5D;YACD,MAAM,IAAIqC,KAAK,CAACF,GAAG,CAAC;;UAErB;QACD;UAAS;YACR,MAAMA,GAAG,GAAG,IAAI,CAACC,SAAS,CAAC,0BAA0B,CAAC;YACtD,MAAM,IAAIC,KAAK,CAACF,GAAG,CAAC;;;;EAIxB;EAEU,OAAOqD,iBAAiBA,CAACN,MAA8B;IAChE,MAAMO,UAAU,GAAG,CAClB,OAAO,EACP,UAAU,EACV,UAAU,EACV,IAAI,EACJ,OAAO,EACP,MAAM,EACN,GAAG,EACH,GAAG,EACH,GAAG,EACH,MAAM,EACN,SAAS,EACT,cAAc,EACd,SAAS,CACT;IACD,KAAK,MAAM,CAACJ,GAAG,EAAErF,KAAK,CAAC,IAAIsF,MAAM,CAACC,OAAO,CAACL,MAAM,CAAC,EAAE;MAClD,IAAIO,UAAU,CAACjE,QAAQ,CAAC6D,GAAG,CAAC,EAAE;QAC7B,IAAIK,KAAK,CAACC,OAAO,CAAC3F,KAAK,CAAC,EAAE;UACzB,MAAM,IAAIqC,KAAK,CAAC,GAAGgD,GAAG,qBAAqB,CAAC;;;;EAIhD;EAeA;;;;EAIUO,sBAAsBA,CAAA;IAC/B,IAAIvG,IAAI,GAAG,EAAE;IACb,IAAI;MACHA,IAAI,GAAG,IAAI,CAAC0C,QAAQ,EAAE,GAAG7D,UAAU,CAAC,IAAI,CAACmB,IAAI,EAAE,CAAC,GAAG,0BAA0B;KAC7E,CAAC,OAAOoE,CAAM,EAAE;MAChBpE,IAAI,GAAG,OAAO;;IAEf,IAAI0C,QAAQ,GAAG,EAAE;IACjB,IAAI;MACHA,QAAQ,GAAG,IAAI,CAACA,QAAQ,EAAE,CAAC8D,QAAQ,EAAE;KACrC,CAAC,OAAOpC,CAAM,EAAE;MAChBpE,IAAI,GAAG,OAAO;;IAEf,IAAIyG,EAAE,GAAG,EAAE;IACX,IAAI;MACHA,EAAE,GAAG,IAAI,CAAC5E,MAAM,CAAC2D,QAAQ,EAAE;KAC3B,CAAC,OAAOpB,CAAM,EAAE;MAChBqC,EAAE,GAAG,OAAO;;IAGb,IAAIC,OAAO,GAAG,WAAW,IAAI,CAAC1F,IAAI,SAAShB,IAAI,UAAU,IAAI,CAACQ,KAAK,UAAU,IAAI,CAACG,KAAK,GAAG;IAC1F+F,OAAO,IAAI,UAAUhE,QAAQ,OAAO+D,EAAE,EAAE;IAExC,OAAOC,OAAO;EACf;EACA;EACQ7B,OAAOA,CAACF,OAAmB,EAAEH,UAAsB,EAAEW,OAAgB;IAC5E,MAAMwB,SAAS,GAAG1H,SAAS,CAACsF,IAAI,CAACI,OAAO,EAAEH,UAAU,CAAC;IACrD,MAAMoC,cAAc,GAAGD,SAAS,CAACE,iBAAiB,EAAE;IAEpD,MAAM/F,CAAC,GAAG8F,cAAc,CAACE,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC;IACxC,MAAM/F,CAAC,GAAG6F,cAAc,CAACE,QAAQ,CAAC,EAAE,EAAE,EAAE,CAAC;IAEzC,MAAMjG,CAAC,GACNsE,OAAO,KAAKlF,SAAS,GAClB4C,MAAM,CAAC8D,SAAS,CAACI,QAAS,GAAG,EAAE,CAAC,GAChClE,MAAM,CAAC8D,SAAS,CAACI,QAAS,GAAG,EAAE,CAAC,GAAGlE,MAAM,CAACsC,OAAO,CAAC,GAAGtC,MAAM,CAAC,CAAC,CAAC;IAElE,OAAO;MAAE/B,CAAC;MAAEC,CAAC;MAAEF;IAAC,CAAE;EACnB"},"metadata":{},"sourceType":"module","externalDependencies":[]}