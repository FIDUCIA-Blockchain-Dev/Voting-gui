{"ast":null,"code":"import { format } from 'web3-utils';\nimport { isNullish } from 'web3-validator';\nimport { TransactionMissingReceiptOrBlockHashError, TransactionReceiptMissingBlockNumberError } from 'web3-errors';\nimport { transactionReceiptSchema } from '../schemas.js';\nimport { watchTransactionByPolling } from './watch_transaction_by_pooling.js';\nimport { watchTransactionBySubscription } from './watch_transaction_by_subscription.js';\nexport function watchTransactionForConfirmations(web3Context, transactionPromiEvent, transactionReceipt, transactionHash, returnFormat) {\n  if (isNullish(transactionReceipt) || isNullish(transactionReceipt.blockHash)) throw new TransactionMissingReceiptOrBlockHashError({\n    receipt: transactionReceipt,\n    blockHash: format({\n      format: 'bytes32'\n    }, transactionReceipt === null || transactionReceipt === void 0 ? void 0 : transactionReceipt.blockHash, returnFormat),\n    transactionHash: format({\n      format: 'bytes32'\n    }, transactionHash, returnFormat)\n  });\n  if (!transactionReceipt.blockNumber) throw new TransactionReceiptMissingBlockNumberError({\n    receipt: transactionReceipt\n  });\n  // As we have the receipt, it's the first confirmation that tx is accepted.\n  transactionPromiEvent.emit('confirmation', {\n    confirmations: format({\n      format: 'uint'\n    }, 1, returnFormat),\n    receipt: format(transactionReceiptSchema, transactionReceipt, returnFormat),\n    latestBlockHash: format({\n      format: 'bytes32'\n    }, transactionReceipt.blockHash, returnFormat)\n  });\n  // so a subscription for newBlockHeaders can be made instead of polling\n  const provider = web3Context.requestManager.provider;\n  if (provider.supportsSubscriptions()) {\n    watchTransactionBySubscription({\n      web3Context,\n      transactionReceipt,\n      transactionPromiEvent,\n      returnFormat\n    });\n  } else {\n    watchTransactionByPolling({\n      web3Context,\n      transactionReceipt,\n      transactionPromiEvent,\n      returnFormat\n    });\n  }\n}","map":{"version":3,"names":["format","isNullish","TransactionMissingReceiptOrBlockHashError","TransactionReceiptMissingBlockNumberError","transactionReceiptSchema","watchTransactionByPolling","watchTransactionBySubscription","watchTransactionForConfirmations","web3Context","transactionPromiEvent","transactionReceipt","transactionHash","returnFormat","blockHash","receipt","blockNumber","emit","confirmations","latestBlockHash","provider","requestManager","supportsSubscriptions"],"sources":["C:\\Users\\lakka\\OneDrive - Manipal Academy of Higher Education\\FIDUCIA\\voting-gui\\fiducia\\node_modules\\web3-eth\\src\\utils\\watch_transaction_for_confirmations.ts"],"sourcesContent":["/*\r\nThis file is part of web3.js.\r\n\r\nweb3.js is free software: you can redistribute it and/or modify\r\nit under the terms of the GNU Lesser General Public License as published by\r\nthe Free Software Foundation, either version 3 of the License, or\r\n(at your option) any later version.\r\n\r\nweb3.js is distributed in the hope that it will be useful,\r\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\nGNU Lesser General Public License for more details.\r\n\r\nYou should have received a copy of the GNU Lesser General Public License\r\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\nimport { Bytes, EthExecutionAPI, Web3BaseProvider, TransactionReceipt } from 'web3-types';\r\nimport { Web3Context, Web3PromiEvent } from 'web3-core';\r\nimport { format } from 'web3-utils';\r\nimport { isNullish } from 'web3-validator';\r\n\r\nimport {\r\n\tTransactionMissingReceiptOrBlockHashError,\r\n\tTransactionReceiptMissingBlockNumberError,\r\n} from 'web3-errors';\r\nimport { DataFormat } from 'web3-types';\r\nimport { transactionReceiptSchema } from '../schemas.js';\r\nimport {\r\n\twatchTransactionByPolling,\r\n\tWeb3PromiEventEventTypeBase,\r\n} from './watch_transaction_by_pooling.js';\r\nimport { watchTransactionBySubscription } from './watch_transaction_by_subscription.js';\r\n\r\nexport function watchTransactionForConfirmations<\r\n\tReturnFormat extends DataFormat,\r\n\tWeb3PromiEventEventType extends Web3PromiEventEventTypeBase<ReturnFormat>,\r\n\tResolveType = TransactionReceipt,\r\n>(\r\n\tweb3Context: Web3Context<EthExecutionAPI>,\r\n\ttransactionPromiEvent: Web3PromiEvent<ResolveType, Web3PromiEventEventType>,\r\n\ttransactionReceipt: TransactionReceipt,\r\n\ttransactionHash: Bytes,\r\n\treturnFormat: ReturnFormat,\r\n) {\r\n\tif (isNullish(transactionReceipt) || isNullish(transactionReceipt.blockHash))\r\n\t\tthrow new TransactionMissingReceiptOrBlockHashError({\r\n\t\t\treceipt: transactionReceipt,\r\n\t\t\tblockHash: format({ format: 'bytes32' }, transactionReceipt?.blockHash, returnFormat),\r\n\t\t\ttransactionHash: format({ format: 'bytes32' }, transactionHash, returnFormat),\r\n\t\t});\r\n\r\n\tif (!transactionReceipt.blockNumber)\r\n\t\tthrow new TransactionReceiptMissingBlockNumberError({ receipt: transactionReceipt });\r\n\r\n\t// As we have the receipt, it's the first confirmation that tx is accepted.\r\n\ttransactionPromiEvent.emit('confirmation', {\r\n\t\tconfirmations: format({ format: 'uint' }, 1, returnFormat),\r\n\t\treceipt: format(transactionReceiptSchema, transactionReceipt, returnFormat),\r\n\t\tlatestBlockHash: format({ format: 'bytes32' }, transactionReceipt.blockHash, returnFormat),\r\n\t});\r\n\r\n\t// so a subscription for newBlockHeaders can be made instead of polling\r\n\tconst provider: Web3BaseProvider = web3Context.requestManager.provider as Web3BaseProvider;\r\n\tif (provider.supportsSubscriptions()) {\r\n\t\twatchTransactionBySubscription({\r\n\t\t\tweb3Context,\r\n\t\t\ttransactionReceipt,\r\n\t\t\ttransactionPromiEvent,\r\n\t\t\treturnFormat,\r\n\t\t});\r\n\t} else {\r\n\t\twatchTransactionByPolling({\r\n\t\t\tweb3Context,\r\n\t\t\ttransactionReceipt,\r\n\t\t\ttransactionPromiEvent,\r\n\t\t\treturnFormat,\r\n\t\t});\r\n\t}\r\n}\r\n"],"mappings":"AAkBA,SAASA,MAAM,QAAQ,YAAY;AACnC,SAASC,SAAS,QAAQ,gBAAgB;AAE1C,SACCC,yCAAyC,EACzCC,yCAAyC,QACnC,aAAa;AAEpB,SAASC,wBAAwB,QAAQ,eAAe;AACxD,SACCC,yBAAyB,QAEnB,mCAAmC;AAC1C,SAASC,8BAA8B,QAAQ,wCAAwC;AAEvF,OAAM,SAAUC,gCAAgCA,CAK/CC,WAAyC,EACzCC,qBAA2E,EAC3EC,kBAAsC,EACtCC,eAAsB,EACtBC,YAA0B;EAE1B,IAAIX,SAAS,CAACS,kBAAkB,CAAC,IAAIT,SAAS,CAACS,kBAAkB,CAACG,SAAS,CAAC,EAC3E,MAAM,IAAIX,yCAAyC,CAAC;IACnDY,OAAO,EAAEJ,kBAAkB;IAC3BG,SAAS,EAAEb,MAAM,CAAC;MAAEA,MAAM,EAAE;IAAS,CAAE,EAAEU,kBAAkB,aAAlBA,kBAAkB,uBAAlBA,kBAAkB,CAAEG,SAAS,EAAED,YAAY,CAAC;IACrFD,eAAe,EAAEX,MAAM,CAAC;MAAEA,MAAM,EAAE;IAAS,CAAE,EAAEW,eAAe,EAAEC,YAAY;GAC5E,CAAC;EAEH,IAAI,CAACF,kBAAkB,CAACK,WAAW,EAClC,MAAM,IAAIZ,yCAAyC,CAAC;IAAEW,OAAO,EAAEJ;EAAkB,CAAE,CAAC;EAErF;EACAD,qBAAqB,CAACO,IAAI,CAAC,cAAc,EAAE;IAC1CC,aAAa,EAAEjB,MAAM,CAAC;MAAEA,MAAM,EAAE;IAAM,CAAE,EAAE,CAAC,EAAEY,YAAY,CAAC;IAC1DE,OAAO,EAAEd,MAAM,CAACI,wBAAwB,EAAEM,kBAAkB,EAAEE,YAAY,CAAC;IAC3EM,eAAe,EAAElB,MAAM,CAAC;MAAEA,MAAM,EAAE;IAAS,CAAE,EAAEU,kBAAkB,CAACG,SAAS,EAAED,YAAY;GACzF,CAAC;EAEF;EACA,MAAMO,QAAQ,GAAqBX,WAAW,CAACY,cAAc,CAACD,QAA4B;EAC1F,IAAIA,QAAQ,CAACE,qBAAqB,EAAE,EAAE;IACrCf,8BAA8B,CAAC;MAC9BE,WAAW;MACXE,kBAAkB;MAClBD,qBAAqB;MACrBG;KACA,CAAC;GACF,MAAM;IACNP,yBAAyB,CAAC;MACzBG,WAAW;MACXE,kBAAkB;MAClBD,qBAAqB;MACrBG;KACA,CAAC;;AAEJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}